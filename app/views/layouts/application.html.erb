<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Culinaria" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Culinaria">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag 'application', 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>

    <%= javascript_importmap_tags %>
  </head>

  <body>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <h5 class="my-0 mr-md-auto font-weight-normal">Culinaria</h5>
  
      <nav class="my-2 my-md-0 mr-md-3" style="margin-left: auto;">
        <span class="p-2 text-dark"> <%= link_to "Главная страница", home_path %> </span>
        <span class="p-2 text-dark"> <%= link_to "Страница про нас", about_path %> </span>
        <span class="p-2 text-dark"> <%= link_to "Добавление статьи", new_post_path %> </span>
      </nav>
      
      <!-- Devise ссылки для входа/регистрации с полными URL -->
      <div class="p-2">
        <% if user_signed_in? %>
          <span class="text-dark me-3">
            <i class="bi bi-person-circle"></i> 
            Здравствуйте, <%= current_user.name.present? ? current_user.name : current_user.email %>
          </span>
          <!-- Используем полный URL для выхода -->
          <%= link_to 'Выйти', main_app.destroy_user_session_url, 
              method: :delete, 
              class: 'btn btn-outline-danger btn-sm',
              data: { turbo_method: :delete } %>
        <% else %>
          <!-- Используем полные URL для входа/регистрации -->
          <%= link_to 'Войти', main_app.new_user_session_url, class: 'btn btn-outline-primary btn-sm me-2' %>
          <%= link_to 'Зарегистрироваться', main_app.new_user_registration_url, class: 'btn btn-primary btn-sm' %>
        <% end %>
      </div>
    </div>

    <div class="container mt-3">
      <% if notice %>
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="alert alert-success alert-dismissible fade show text-center shadow" role="alert">
              <strong><i class="bi bi-check-circle me-2"></i></strong>
              <%= notice %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>
        </div>
      <% end %>
      
      <% if alert %>
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="alert alert-warning alert-dismissible fade show text-center shadow" role="alert">
              <strong><i class="bi bi-exclamation-triangle me-2"></i></strong>
              <%= alert %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="container mt-3">
      <%= yield %>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>